%%
%% LaTeX Hetare Template
%%
%% Author: Yasunori Yusa
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% # ビルド方法
%
%     % platex latex_hetare_template.tex
%
% DVI ファイルその他が出力される。
%
%     % dvipdfmx latex_hetare_template.dvi
%
% PDF ファイルが出力される。
%
% または、付属の Makefile を使って自動化する。
%
%     % make
%
% # トラブルシューティング
%
% ## PDF が文字化けする。
%
% latex_hetare_template.tex の文字コードに注意する。
% このテンプレートは Ubuntu 12.10 以降の platex のデフォルトの
% UTF-8 (改行コードは LF) を基本とする。
% とりあえず、ソースコードを変換してみる。
%
%     % nkf -wLu --overwrite latex_hetare_template.tex
%
% あとは、platex で明示的に文字コードを指定してみる (Ubuntu 以外の環境で有効)。
%
%     % platex -kanji=utf8 latex_hetare_template.tex
%
% Ubuntu 12.04 以前は UTF-8 が使えないので EUC-JP などに変換して使う。
%
% ## 参考文献、数式、表、図の参照が ?? になる。
%
% platex を何回か実行する。通常は 2 回で十分。
% 仕組みを知りたい人は出力された latex_hetare_template.aux を参照。
%
% ## platex がエラーで止まったときに Ctrl+c で抜けられない。
%
% X (ただの大文字の X) を入力してターーーンッ！
% または、Ctrl+d を押してみる。
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% # 本文を書く前に
%
% まずはドキュメントクラスを読み込む。
% jsarticle.cls が定番 (読み込むときに拡張子は書かない)。
% 学位論文では jsbook.cls もよく使われる。
% 読み込むときにオプションを指定できる。
% フォントサイズ 11pt、用紙サイズ a4j 辺りがよく使われる。
%
\documentclass[14pt,a4j]{jsarticle}
%
% 続いてパッケージ (スタイルファイル) を読み込む。
% amsmath.sty と amssymb.sty と graphicx.sty が定番で、
% 何も考えずにとりあえず読み込んでおくのが一般的。
%
\usepackage{amsmath}  % アメリカ数学会の数式拡張。
\usepackage{amssymb}  % アメリカ数学会の数学記号拡張。
\usepackage[dvipdfmx]{graphicx} % 画像関連のコマンドを提供する。
%
% 準定番なパッケージもいくつか紹介する。
%
\usepackage[margin=25truemm]{geometry} % 余白を設定する。上下左右 25 mm の例。
\usepackage{cite} % \cite{} の順番を自動調整してくれる。[3, 5, 4, 1] -> [1, 3-5]
\usepackage{url} % \url{} コマンドを有効にする。URL やメールアドレスに使う。
%
% 中級者以上が日常的に使っているパッケージもいくつか紹介する。
% これらのパッケージは、ただ読み込むだけじゃなくて、
% いくらか中級者的な設定をする必要がある。
%
% \usepackage{hyperref} % PDF にしおりを付ける。
% \usepackage{fancyhdr} % ヘッダ、フッタを調整する。
% \usepackage{algorithm,algorithmic} % 擬似コード
% \usepackage{listings} % ソースコード
%
% ついでに、かなりマニアックだけど欧文フォント関連パッケージも紹介してみる。
% デフォルトの欧文フォントはこれらとは違って
% Computer Modern という LaTeX 独自のもの。
%
\usepackage{txfonts}  % 本文セリフ体・数式に Times を使う。
% \usepackage{pxfonts}  % 本文セリフ体・数式に Palatino を使う。
% \usepackage{mathptmx} % 本文セリフ体・数式に Times を使う。txfonts.sty とは別の実装。
% \usepackage{mathpazo} % 本文セリフ体・数式に Palatino を使う。pxfonts.sty とは別の実装。
\usepackage{helvet}   % 本文サンセリフ体に Helvetica を使う。
% \usepackage{avant}    % 本文サンセリフ体に Avant Garde Gothic を使う。
\usepackage{courier}  %j 本文モノスペースに Courier を使う。
%
% パッケージを読み込んだら、とりあえずタイトル、オーサー、日付を書く。
% この記述は別に必須ではないけど、よく書かれる。
% \LaTeX のように \ で始まる文字列は LaTeX のコマンドで、
% \LaTeX は LaTeX のロゴっぽいものを出力する。
% その後ろの単独の \ はなんか空白をエスケープしている
% (これがないと LaTeX と Hetare がくっついてしまうため)。
% \thanks{}、\today も同様にコマンドで、
% 順に、オーサーの所属 (なくてもいい)、今日の日付を出力する。
%
\title{東京大学大学院工学系研究科システム創成学専攻 
\protect\\修士論文
\\複数の交通事故モードを実装した交通流シミュレータの開発
\\指導教員吉村忍教授}

\author{久保恒太\thanks{東京大学大学院工学系研究科システム創成学専攻}}
\date{\today}
%
% あとは、独自のコマンドを定義するときはこの辺に書く。
% \newcommand{コマンド}{定義} という書式で書く。
% ここでは、よく使われる \diff と \bvec{} を書いておく。
%
\newcommand{\diff}{\mathrm{d}} % 全微分の d はローマン体だよ派がよく使う。
\newcommand{\bvec}[1]{\mbox{\boldmath $#1$}} % 行列・ベクトルはボールドイタリック体だよ派がよく使う。
%
% さて、以上のようなヘッダ (プリアンブルと呼ぶ) を書き終わったら本文を始める。
% これ以降、\begin{} と \end{} というコマンドをよく使う。
%
\begin{document}
%
% まずは、タイトル、オーサー、日付を出力する。
% \maketitle というコマンドを書くと、
% ドキュメントクラス (jsarticle.cls) で定義されている見た目で出力される。
%
\maketitle
%
% タイトルの次には、アブストラクトを書く (省略可能)。
%
%
% いよいよ本文だが、まずは章立てのコマンドを紹介する。
% 順に、部、章、節、小節、小々節。
%
% * \part{}
% * \chapter{}
% * \section{}
% * \subsection{}
% * \subsubsection{}
%
% jsarticle.cls では \section{} から始めるのが一般的。
% jsbook.cls では \part{} や \chapter{} から始める。
%
\newpage

\tableofcontents
\newpage
\section{序論}

\subsection{研究の背景}
　国土交通省では平成27年までに24時間死者数を3,000人以下に、死傷者数を70万人以下とすることで、世界一安全な道路交通を実現するという目標を掲げている。また、死傷事故の約70％が道路全体の20％の区間に集中しているという事実から、幹線道路の中でも特に危険な箇所を特定し、その箇所に対して重点的に対策を仕掛けている。
道路改良による対策としては、右折レーンの延伸、歩道の整備、最高速度制限などが挙げられる。また、交通安全施設の設置としては、防護柵、導流表示、注意喚起表示（LED表示）などの設置が挙げられる。\\
　これらの道路や施設設置による従来までの対策に対して、近年の傾向としては交通事故対策として、高度交通システム(ITS)\cite{ITS-Japan}と呼ばれる,IT技術を駆使し、人と道路と自動車の間で情報の受発信を行い、道路交通が抱える事故や渋滞、環境対策など、様々な課題を解決するためのシステムを利用したものも登場している。交通安全支援のITSであるITSスポットサービス\cite{MLIT-1}では、道路に設置にされたITSスポットから車載されているカーナビに対して情報を送る。これにより、カーブなどの見通しが悪い場所でも近くに車がいることをITSスポットが知らせることで、事前に事故を防ぐことができる。他にも、車両前方のレーダーが先行車を察知し、追突の危険が高まった場合には自動的にブレーキをかけることで追突事故を未然に防ぐ、自動車被害軽減ブレーキ\cite{MLIT-2}などがある。\\
　このような国土交通省をはじめとした，行政の重点的な交通事故対策により，日本の事故死亡者は1992年から，また，事故発生件数は2004年から連続して減少傾向にある．図\ref{fig:accident-translation}に近年の交通事故による死者数および負傷者数を示す。しかし、依然として平成25年中の年間交通事故死者数は4,373人負傷者数は役78万人\cite{police2013}である．この数字が示すように交通事故は依然として大きな社会問題であり，交通事故をなくすことは国家の利益につながる．\\
\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 624 407]{./img/accident-translation.pdf}
  \caption{交通事故死者数、負傷者数の推移}
  \label{fig:accident-translation}
\end{figure}
　この様な状況の中で交通事故に対して効果のある安全支援対策が待ち望まれるが、各対策を評価し、効率的に実施していくことが重要である。交通安全支援施策を評価しようとする時に、問題となるのが実験の困難さである。交通現象の実験では道路やその周辺施設を実験のたびに工事しては大きな費用がかかる。そのため、交通流シミュレーションによって、実際交通事故を再現できると，道路や交通規制の設計，ITS推進や交通教育への利用などによる事故状況の変化を仮想的に再現することでそれらの施策を評価することができる。こうした点で交通事故を再現する交通流シミュレータによる安全支援施策評価は事故の減少に寄与すると考えられる。
\subsection{交通事故シミュレーションの現状}
マルチエージェントを用いた交通流シミュレーションに関する研究は現在まで、多くされてきた。それらの研究は交通渋滞に関するものなどが多く、交通事故に関するものは少ない。その理由としては、そもそも交通事故をモデル化することが難しいことなどが挙げられる。こういった中で行われてきた既存研究では交様々なモデルを提案し交通事故の再現してきた。
田中らの研究では認知エラー・判断エラー
自動車の運転行動は認知・判断・操作の3つの過程に分類される．この3つの過程のどこかにエラー状態が起きた時に交通事故は発生する(2)．既存の交通流シミュレータにおける交通事故の実装においても，この考え方に沿ったものが多い．認知段階におけるエラーでは，認知フィルタという概念により，ドライバ間での認知レベルの差を表した田中ら(3)のモデルや，藤井ら(4)の中心視野と周辺視野を考慮したモデルなどがある．また，古川ら(5)の研究はエージェントの判断によるエラーに踏み込んだものである．これらの研究では交通事故を実現象に近い形で再現してはいるものの，例えば，特定の交差点など局所での安全施策評価での利用に限られており，広域なシミュレーションには利用できず，実際に街路を設計する際の交通安全施策評価の実用性の問題が残る．このような現状から広域で利用できる交通流シミュレータが必要とされている．
\subsection{研究の目的}
本研究の目的は都市単位での様々な広域での交通安全施策評価が可能な交通流シミュレータの開発である．交通情報である道路形状、交通量、信号の配置、点灯、建物の情報を入力することで、事故情報である事故発生件数、事故形態、事故発生箇所などを出力するマルチエージェントシミュレーションである。具体的な利用方法としては、都市などで道路構造を変えたり、交通量が変化した時にどの様に事故が増えるか減るかなどを行政や地方自治体が試算するために利用するなどが考えられる。
\newpage
\section{研究手法}
\subsection{研究手法の特徴}
以下に本研究手法におけるにおける特徴を述べる。
\subsubsection{複数のモデルに対する複数の事故をモデル化・実装}
　本研究においては、5つの事故である追突事故・出会い頭事故・右左折事故・進路変更・正面衝突事故を扱う。これらの事故が起こる過程においては、それぞれ別々のエラーが起こり、事故に繋がるというモデルになっている。交通事故をモデル化する際に汎用的な単一のモデルを用い様々な事故を再現するという手法もあるが、本研究では実際に起こりやすい事故について、事故が発生するまでのプロセスはそれぞれに違った現象であるという立場からこの手法を採用した。
\subsubsection{認知・判断エラーをモデルに加味}
　認知・判断エラーについて説明する前に、自動車の運転行動について説明する。運転行動は一般的に認知・判断・操作の3つの過程に分類される\cite{ITARDA2005}。認知過程では、安全に通行するために必要な物を見る（発見する）ことであるが、これは単に見る
判断過程では、認知した対象がどのような行動をするのか、自分はどのように行動すればよいのか
操作過程では、判断や決定に従ってハンドルやブレーキなどを操作する。例えば赤信号における停止という運転行動では、赤信号を見て（認知），減速しようと考え（判断），ブレーキを踏む（操作）といった流れとなる．\\
　過去の研究においては認知エラーが採用されているものが多い、認知エラーによる事故は件数も多く、見えているかどうかということが物理的に比較的明確な現象なのでモデル化しやすいからである。これに対して判断エラーを考慮することは人間の思考の一部をモデル化することとなり、様々な考慮をしなければならない。古川らは交通事故シミュレーションを行う上でこの判断エラーを取り入れた\cite{Furukawa2009}。この研究ではUDM(Universal Design Model)というモデルを提案している。UDMにおける認知過程ではエージェントがそれぞれ現実の世界とは違う外部世界というものを保持している。エージェントは認知段階において外部世界に情報を蓄える、そして判断段階では現実の外部環境ではなく、外部世界から情報を参照する。また、ドライバは個性や心理状態に応じて運転欲求を持っており、の欲求に応じて判断を変えてリスク判断を行っていく。このリスク判断の部分については確率的な計算を行っている。外部世界モデルの概念はエージェントによって見えているものがそもそも違い、判断についてもその時々によって異なるということを表している点で現実の運転行動をよく表現していると考えられる。そのため、本研究ではモデルを構築する上で外部世界の概念を取り入れ、判断・認知エラーを加味することとする。操作段階におけるエラーについて事故件数が少ないとされているため，本研究では扱わない．
\subsubsection{計算時間を考慮した簡易なモデル}
　本研究の目的とする広域での交通流シミュレーションを実現するためには計算時間の短縮が不可欠であるが、認知・判断過程でエージェントにエラーを起こすということは複雑な計算を行う場合が多く、計算量が多くなりがちである。藤井らの研究\cite{Fujii2011}は認知エラーに絞り単一のモデルから構築されており、ドライバに見えている景色を二次元の画像として、各ドライバのエージェントが持つことで、他のエージェントを認知できなくなった時に衝突の可能性がある。認知できるかどうかの判断については、中心視野、周辺視野を考慮している。この研究は人間の視覚を精緻に再現し、現実と近いものになってはいるものの、二次元の図を各タイムステップで描く必要があり、計算量が膨大となるため、広域での交通流シミュレーションには向かない。本研究では目的に合わせ、現実の事故を再現しながらも、簡易なモデルを構築するという手法で広域での交通流シミュレーションを実現する。

\subsubsection{事故率を出力}
安全施策評価の具体的な方法としては、各種の安全支援ITSをシミュレーションで実装した時や、道路構造を変化したときなどの事故率の変化が考えられる。この目的を達成させるためにはある施策が事故にどの程度効果があるかを評価できればよく、必ずしも、現実と同じ程度の事故件数を必ずしも発生させる必要はない。また、交通事故は日本全体で見ると年間約80万件も年間に発生しているが、ある都市で数日間の事故件数を見てもそんなに多発するものでもない。そのため、安全支援策が有効であるかを測るためには、必然的に長期間のシミュレーションが必要になり、計算量の多い広域での交通流シミュレーションでは効率が悪い。そのため、本研究では現実の事故より事故率を発生するようにしている。

\newpage

\subsection{交通流シミュレータMATES}本研究では、著者らが開発中の知的マルチエージェント交通流シミュレータMATES (Multi-Agent-base Traffic and EnvironmentSimulator)に新たな認知・判断モデルを追加・実装する．MATESにおいてドライバはエージェントとしてモデル化されており，周囲の環境から情報を取得して自律的に行動する．複雑な交通流を再現可能であり．現実の現象に即した交通事故を再現する。また、近年の傾向として、大規模なシミュレーションでも対応可能であるように並列化も行われおり、計算不可の高い交通事故をシミュレーションに適している。これらの理由からMATESは本研究の目的に適した交通流シミュレータであるといえる．
\subsection{MATESにおける認知・判断・操作}
ここでMATESにおける認知・判断・操作について説明する。MATESにおいては、0.1秒ごとに各エージェントが運転行動を行う。各タイムステップでの認知・判断・操作の全体のフロチャートを図\ref{fig:flow}に示す。\\\\
\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 624 407]{./img/flow.png}% 画像サイズ 320pt x 240pt の例
  \caption{認知・判断・操作のフロチャート}
  \label{fig:flow}
\end{figure}
\textbf{認知}\\
認知段階では認知対象物である先行車、交差点交錯車両、信号、進路変更次の並走車などを仮想先行車と呼び、その位置や状態を取得し、エージェントに格納していく。
どの様にエージェントが認知を行っているかを先行車の認知を例にして説明する。エージェントが所属する車線オブジェクトがその車線上にあるエージェントの情報を持っており、かつ、車線の始まりから終わりにかけて、車両の配置されている順番とともに情報を持っている。そのため、エージェントが先行車を取得するには車線オブジェクトに問い合わせるということになっている。この様にMATESでは様々なオブジェクトが互いに情報を持ち合い参照し合うことで、認知がなせるようになっている。この様にして、認知したオブジェクトを仮想先行車のベクトルに格納していく。\\\\

\textbf{判断}\\
判断段階では、次のタイムステップでの速度の決定をしている。認知段階で取得した各仮想先行車に対して、衝突しない中でそれぞれのエージェントが持つ希望速度に最も近い速度を算出する。速度の算出にはに追従モデルを用いている。ここで算出された速度のうち最小のものを速度とする。\\

\textbf{操作}\\
操作段階では判断段階で算出した速度に対して、実際のエージェントの位置情報を書き換える
これを繰り返すことによって、MATES内での運転行動は行われている。


\newpage
\subsection{交通事故の分類}
交通事故は分類して考えられる。図\ref{fig:accident-classification}は平成15年から平成25年までに起きた交通事故を分類分けをした円グラフである。このグラフは警察庁のデータ\cite{police2013}を元に作成した。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 350 340]{./img/accident-classification.pdf}
  \caption{平成15~25年における交通事故の分類}
  \label{fig:accident-classification}
\end{figure}

これによるとこの年に最も多かった事故は追突、ついで出会い頭事故、右折と続いている。その他が10％と少なく、事故の大部分が大まかに分類されているのがわかる。この様に現実の事故が分類できることから、本研究においても、これらの事故から代表的なものを取り出し、それぞれ個別にモデル化することで，より実現象に近い形で交通事故が発生することを目指す．これらの事故のモデル化に際しては自動車技術会が発表している交通事故予測シミュレーションシステム検証マニュアル\cite{manual2013}を参考にした．このマニュアルは予防安全策の開発において、その効果を予測・
故予測シミュレーションシステムが備えている機能レベルや交通状況の再現能力を評価するための標準的な検証・評価手続きを示したものである。以下に5つの事故の状況を述べる．\\\\
\textbf{(1) 追突}\\交差点手前で停止した先行車に追突．先行車は早い段階で停止したが，自車は先行車以外の対象物を認知していたもしくは，脇見しており，先行車を認知できないため追突する．\\\\
\textbf{(2) 出会い頭}\\ 交差点を直進で進入しようとした時，側方から他車が出てきたため，出会い頭の衝突．建物が密集していたため，他車の発見が遅れたと考えられる．\\\\
\textbf{(3) 右左折}\\ 交差点内で自車が右折しようとしているときに，対向車は左折もしくは直進をしようとし，自車の方が先に通過できると見誤ったために衝突\\\\
\textbf{(4) 進路変更}\\進路変更時，隣のレーン後方から車両が接近していることに気づかず進路変更を行ったため衝突\\\\
\textbf{(5) 正面衝突}\\ 脇見運転をしており，対向車線に進入したため衝突
\newpage
\subsection{エラーの分類}
　交通事故の要因であるエラーの分析を行った．エラーの分類には自動車技術会の公開しているヒヤリハットデータや，山田らの交通事故シナリオの研究\cite{yamada2010}を参考にした．その結果，事故要因を以下の3つに絞った．見えないことによる認知エラー，見ていないことによる認知エラー，傲慢な判断エラーである．これら4つのエラーについて説明する．
\subsubsection{見えないことによる認知エラー}
　衝突しうる，また，その原因となりうる対象物（先行車，信号，並走車など，以降認知対象物とする）が物理的に見えない状態である．例えば見通しの悪い交差点などで側方から進入した車両と衝突する場合などはこの原因が強いと考えられる．
\subsubsection{見ないことによる認知エラー}
　物理的に認知対象物が見える状態であっても，ドライバが見ていないという状態と定義する．例えば脇見運転が該当する．
\subsubsection{傲慢な判断エラー}
　認知対象物を認知している場合において，判断の誤りによって起こるエラーである．右折対左折の事故において，対向車を認知しつつも，対向車が道を譲ってくれると判断した時などはこのエラーを原因とする．また，見通しの悪い交差点で，左右確認をせずに交差点に進入する場合もこのエラーが原因の一つとなる．
これら4つのエラーを各事故に関して，実装した．
\newpage
\section{交通事故のモデル化と実装}
\subsection{追突事故}
\subsubsection{概要}
　追突事故は先行車の後方と、後方車の前方が追突することや、低速での発生が多いことから幸い死亡事故の割合は他の事故と比べて少ないものの、全体の事故の中でも37\%を締め絶対数としては最も多い事故である。2003年に交通事故研究センターで行われた追突事故の調査\cite{ITARDA2003}によると追突事故の原因は図\ref{fig:rear-cause1}の様に分けることができる。このグラフを見ると、追突事故の多くは見ないことに起因しているといえる。また、この先行車を見なかったという原因を図\ref{fig:rear-cause2}に示す。この結果から、本研究における追突事故のモデルでは脇見をしたことにより、見ない認知エラーが生じ、事故が発生するものとする。

\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 1004 450]{./img/rear-cause1.png}
  \caption{追突事故の要因}
  \label{fig:rear-cause1}
\end{figure}

\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 1004 450]{./img/rear-cause2.png}
  \caption{先行車を見なかった要因}
  \label{fig:rear-cause2}
\end{figure}
\subsubsection{脇見運転モデルによる見ない認知エラーの発生}
脇見をしたことにより、認知対象物を見ることができなくなる確率が高くなるということから、各タイムステップにおいて先行車以外の認知対象物が多いほど認知エラーが発生する確率が高くなるよう設定した．ここでの認知対象物とは先行車、信号、並走車（進路変更時）、合流車である。見ない認知エラーが発生する割合を追突事故におけるエラー率とする。

\subsubsection{先行車位置の予測と事故の発生}
見ない認知エラーが発生した時，自車は先行車を認知するのではなく予想して、本来とは違う速度、距離を保持する．認知エラーが起きた後には，最後に先行車を認知した時に得られた先行車の速度情報をもとにその位置を外挿予測する．これは現実の運転行動においては、先行車を見ていないからといって完全に意識していない訳ではなく、記憶に残しつつ脇見をしていると考えるからである。この様にして計算された先行車と自車の位置に乖離がある場合に先行車の正確な位置を把握できず，追突事故が発生する可能性がある．

追突事故が発生するまでのフロチャートを図\ref{fig:rear-flow}に示す。\\
\begin{figure}[phtb]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 292 674]{./img/rear-flow.png}
  \caption{追突事故のフロチャート}

  \label{fig:rear-flow}
\end{figure}

\clearpage
\subsection{出会い頭事故}
\subsubsection{概要}　
追突事故に次いで発生件数が多いのが出会い頭事故である。交通事故分析センターによる出会い頭事故の要因の分析結果\cite{ITARDA2005}によると、出会い頭事故の要因には認知エラーと判断エラーの2つがある。認知エラーのうち80\%以上が交差車両を何らかの理由で認知できなかったという、信号のない見通しの悪い交差点などでおきるものである．そのため，本モデルでは信号のない交差点で建物等の遮蔽物があることで，遮蔽物に隠れた車両を認知できなくなるという，見えないことによる認知エラーを再現する．また、視野の制限が起きた時に、見通しの悪い交差点で一時停止するという機能を付け加えた。これに対して、判断エラーで多いのが、見通しが悪い状況でも、自車が優先していけると思った、特に見通しの悪さを気にしなかったなどの理由が挙げられる。これらの点から、傲慢な判断エラーが起きている時には、見通しの悪い交差点で（認知エラーが起きている時に）一時停止としないこととした。
\subsubsection{遮蔽物の配置}
シミュレーション開始時に全ての交差点について、遮蔽物を配置するかどうか決める。一つの交差点における遮蔽物の数はその交差点とつながっている単路の数から、見通しの計算に寄与しない遮蔽物の数を引いたものである。例えば四叉路の場合図\ref{fig:barrier}の様に遮蔽物が配置される。配置には交差点で隣合う単路、例えば単路1,2の間に遮蔽物を一つずつ配置する。図の様な場合遮蔽物は4つ配置されることとなる。また、この様にして遮蔽物が間にある単路に「見通しの悪い単路」と定義する。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 906 783]{./img/barrier1.png}
  \caption{四叉路における遮蔽物}
  \label{fig:barrier1}
\end{figure}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 836 733]{./img/barrier2.png}
  \caption{三叉路における遮蔽物}
  \label{fig:barrier2}
\end{figure}
また、ここで言う見通し計算に寄与しない遮蔽物とは、交差点とそれにつながる2つの単路とのなす角度が180度以上になっているような場合である。例えば図\ref{fig:barrier2}の様に単路1や3から交差点に進入する車両にとって遮蔽物3は見通しに寄与しない。この様にして、その2つの単路がなす角度が180度以上の場合、遮蔽物の配置は行わないものとした。
\clearpage
\subsubsection{見通し計算とエラー}
見通し計算について説明する。見通し計算には二つのエージェントを結ぶ線分をエージェントどうしの視線として、遮蔽物の対角線と交差判定することにより認知ができるかどうかを判定している。交差判定には外積による計算を用いている。図\ref{fig:sight-judge}(左)は認知ができている状態を表し、図\ref{fig:sight-judge}(右)では認知ができていない状態である。この見通し計算は全ての遮蔽物が、各タイムステップで行っている。遮蔽物は生成された時に隣接する2つの単路と交差点の情報を保持している。そこから2つの単路上に存在し、かつ、遮蔽物が保持する交差点に向かっているエージェントの情報を参照し、それらの見通し計算を行う。ここで認知エラーが発生した場合、交錯するエージェントを認知することができなくなる。
\newpage
\begin{figure}[htbp]
  \centering
  \includegraphics[width=1.0\hsize,bb=0 0 1179 692]{./img/sight-judge.png}
  \caption{（左）認知できているとき　（左）認知エラーが生じているとき}
  \label{fig:sight-judge}
\end{figure}


\subsubsection{傲慢な判断エラーの発生}
傲慢な判断エラーが発生するかどうかは、確率的に決定している。判断エラーが起きるかどうかの決定は、常に同じエージェントがいつも、傲慢な判断エラーを起こすとは限らないという考えから、車両生成時ではなく、単路に進入するときに行っている。判断エラーがおきる確率を出会い頭事故のエラー率とする。見通しの悪い単路を通って交差点に進入するエージェントのうち、傲慢な判断エラーが起きていないエージェントについては、「遮蔽物の陰から車両が飛び出してくるかもしれない」と判断して交差点の前で一時停止をするようにした。逆に判断エラーが起きているエージェントは、交錯する車両の存在を確認しないため、出会い頭事故が発生する可能性がある。図\ref{fig:passing-flow}に出会い頭事故が発生するまでのフロチャートを示す。
\newpage
\begin{figure}[phtb]
  \centering
  \includegraphics[width=0.6\hsize,bb=0 0 523 864]{./img/passing-flow.png}
  \caption{出会い頭事故のフロチャート}
  \label{fig:passing-flow}
\end{figure}


\clearpage
\subsection{右左折事故}
右左折事故の多くは信号で整理されている交差点で発生するものが多い。ここでモデル化する左折信号のある交差点で自車が左折しようとしてかつ対向車が右折をしようとしてきた時に発生するものである．交差点が前方に存在し，対向車が存在する場合に傲慢な判断エラーが起きる可能性がある．この傲慢な判断エラーが起きる割合を右左折事故におけるエラー率とする。エラーが生じている場合には自車と対向車が交差点を通過し切る時間を計算する。また、ここで自車が通過仕切る時間をT1,対向車が通過仕切る時間をT2とする。ここで判断エラーが発生しているエージェントは自車が通過仕切る時間を早く見積もるという考えから、その誤差を誤差時間ΔTとすると、T1-ΔTがT2より小さければ、自車の方が対向車より早く通過できると予測したとなり，実際には交差点に進入すると衝突する可能性がある場合でも，交差点へ進入する．実際には対向車が先に交差点に進入すべき時に自車も交差点に進入することがあるため，衝突事故が起こる可能性がある．右左折事故が起きるまでのフロチャートを図\ref{fig:LR-flow}に示す。
\newpage

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 361 731]{./img/LR-flow.png}
  \caption{右左折事故のフロチャート}
  \label{fig:LR-flow}
\end{figure}

\clearpage
\subsection{進路変更事故}
進路変更は運転行動の中でも複雑な行動となり、危険な事故が発生する可能性がある。自動車技術会のHPで公開されている、典型的な進路変更による事故やヒヤリハットの動画\cite{jsae-movie}によると、進路変更事故の原因の多くは脇見や不注意により、後方確認をせず、後方から来た車両と接触するというものが多い。そのため、本研究のモデルでは、見ない認知エラーが起こること、後方に車両があった場合であっても認知せずに進路変更を始めるというものとする。また，このエラーが発生するかどうかは車線変更を始める時に確率計算される。ここでMATESにおいてエージェントが車線変更を行うタイミングを説明する。エージェントが単路にいる時に、次の交差点で右左折、直進するために車線変更をしなければならない時であり、追越・追抜等で車線変更をするということはない。確率計算に関しては追突事故と同じように，認知対象物が多ければ多いほど，エラーが生じる確率が高くなる脇見運転モデルを用いる．また、このエラーが起きやすさを進路変更事故のエラー率とする。この見ない認知エラーが起こった時に進路変更による事故が発生する可能性がある。進路変更事故が起きるまでのフロチャートを図\ref{shift-flow}に示す。
\newpage

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 317 640]{./img/shift-flow.png}
  \caption{進路変更事故のフロチャート}
  \label{fig:shift-flow}
\end{figure}

\clearpage
\subsection{正面衝突事故}
正面衝突の事故は件数こそ少ないものの、衝突する車両どうしの速度が非常に速いことや、衝突する位置の関係上、重症事故・死亡事故になることが多く非常に重大な事故である。勝岡らの報告\cite{katsuoka}によれば、典型的な正面衝突事故は居眠りや、不注意によって車両が対向車線に進入することにより発生することが多い．そこで正面衝突では見ない認知エラーが発生することで，対向車線に接する最内車線を走行中に対向車線に進入するというモデルを構築する。

まず対向車線が存在するかどうかは、同じ単路内の車線を全て取得し、エージェントが単路内同一方向において、一番右側の車線（これを最内車線と呼ぶ）に存在するかどうを確かめることで確認する。エージェントが最内車線にいて、対向車線が存在する時に確率計算を行い、見ない認知エラーが発生するかを決定する。このエラーが起きる確率を正面衝突事故におけるエラー率と定義する．エラー発生時に，車両を対向車線側に移動するということとした．移動した後は元の位置から右側へ3m移動した後に元の位置へ戻るものとする。対向車両が存在するときに正面衝突の事故が起こる可能性がある．正面衝突事故のフロチャートを図\ref{fig:head-flow}に示す。

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 396 816]{./img/head-flow.png}
  \caption{正面衝突事故のフロチャート}
  \label{fig:head-flow}
\end{figure}

\clearpage
\subsection{衝突判定}
ここでは衝突判定のアルゴリズムについて説明する。
計算負荷低減のため、衝突判定はエラーが起こっているエージェントと衝突対象のエージェントに対してのみ行い、かつ事故の種類によって違う衝突判定を行っている。以下3つの種類の衝突判定を挙げる。
\subsubsection{追突事故の衝突判定}
　追突事故の衝突判定は先行車との衝突であり、一次元的な考えで判定ができるため、比較的簡易なアルゴリズムを使用している。図\ref{rear-collid}を用いて説明する。エージェント1とエージェント2のの中心の位置を取得し、その距離を\textit{d}とする。また、1,2それぞれの車体の進行方向の長さを$\textit{l}_{1}$,$\textit{l}_{2}$
1.2とすると以下の式が成立するときに、衝突したと判定する。この判定は追突の可能性があるエラーがあるときのみ、先行車判定の部分に実装している。
\begin{equation}
  d < l_1 + l_2
\end{equation}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\hsize,bb=0 0 567 810]{./img/front-collid.png}
  \caption{追突事故の衝突判定}
  \label{fig:rear-collid}
\end{figure}
\clearpage
\subsubsection{進路変更・正面衝突事故の衝突判定}
進路変更、正面衝突事故の衝突判定も基本的には追突と同じ手法で行うが、車体が横にずれるため二次元的な動きになる。よってエージェント1とエージェント2の距離の\textit{x}成分を$\textit{d}_\textit{x}$,\textit{y}成分を$\textit{d}_\textit{y}$とし、1,2それぞれの車体の進行方向の長さを$\textit{l}_{1}$,$\textit{l}_{2}$、幅方向の長さを$\textit{w}_{1}$,$\textit{w}_{2}$とすると以下の2つの式が成り立つときに、衝突したと判定する。
\begin{eqnarray}
  d_x < w_1 + w_2 
  d_y < l_1 + l_2 
\end{eqnarray}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/side-collid.png}
  \caption{進路変更・正面衝突事故の衝突判定}
  \label{fig:side-collid}
\end{figure}
\clearpage

\subsubsection{出会い頭・右左折事故の衝突判定}
最後に出会い頭・右左折事故の衝突判定であるが、この判定では衝突時車体どうしが並行な状態ではないため、進路変更・正面衝突事故のアルゴリズムでは対応しきれない。そのため少々複雑な計算手法を用いた。2つの長方形が接触していないということは、長方形の間に線分が引けるということに言い換えられる。ここでその様な2つの長方形の間の線分に垂直な軸を分離軸とする。また、分離軸に対する長方形の射影を投影線分と呼ぶ。ここでは投影線分が離れていれば交差していないということになる。（図\ref{fig:line-shadow}）
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/line-shadow.png}
  \caption{分離軸と投影線分}
  \label{fig:line-shadow}
\end{figure}
\clearpage
長方形が接触しているということは結局辺が交わっていると考えられるため、次に線分の交差について分離軸を用いて考える。またこの概念を線分についても考える。図\ref{fig:lines1}（左）では1,2の線分は交わっている。これを分離軸を使って考えると図\ref{fig:lines1}（右）の様に投影線分に対してもう片方の線分の射影を凝縮点と呼ぶ。この凝縮点が互いの投影線分に含まれていれば、2つの線分は交わっている。図\ref{fig:lines2}は、交わっていない線分について、表したものである。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lines1.png}
  \caption{（左）交差した線分（右）投影線分と凝縮点}
  \label{fig:lines1}
\end{figure}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lines2.png}
  \caption{（左）交差していない線分（右）投影線分と凝縮点}
  \label{fig:lines2}
\end{figure}
\clearpage
車体が長方形であるため、対辺が平行なため、投影線分は全部で4本だけでよい。これは単純にお互いの辺の交差判定を(4×4=)16回するよりかなり少ない計算量で済む。図\ref{fig:inter-collid1}の様に投影線分と凝集点が、接していない時にエージェントどうしは衝突していないと判定できる。図\ref{fig:inter-collid2}のように計算には1,2の投影線分への距離を\textit{d}車体の投影線分への射影の半分を$\textit{r}_{1}$,$\textit{r}_{2}$とすると、以下の式
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/inter-collid1.png}
  \caption{4つの投影線分}
  \label{fig:inter-collid1}
\end{figure}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/inter-collid2.png}
  \caption{衝突判定の計算}
  \label{fig:inter-collid2}
\end{figure}

\begin{equation}
  d < r_1 + r_2
\end{equation}
が4つの投影線分全てについて成り立つときに、エージェントどうしが衝突したと判定する。
\clearpage
\section{挙動検証と感度解析}
実装したそれぞれの事故について、挙動の検証および感度解析を行った。
\subsection{挙動検証概要}
MATESでのシミュレーションを可視化したものから、挙動の検証を行った。画像について、エラーが発生していないエージェントは青色、エラーが発生しているエージェントは赤色となっている。また、事故が発生したときのエージェントは黒色で表示される。
\subsection{感度解析概要}
本モデルにおいては先述したように、現実の事故率より高い事故率を出力するが、どの程度の割合でどの事故が起こるのかというのは現実の数字に合わせる必要がある。この割合がどの程度が適切であるかを調べるために、交通量に対する事故率の変化、エラー率に対する事故率の変化を求め、感度解析を行った。
\subsubsection{交通量と事故率の関係}
現象の理解のため、交通量と事故率との関係についてもそれぞれ、実験を行った。ここでの事故率\cite{MLIT3}は事故件数等の絶対数を道路延長と交通量で基準化したものであり、事故危険度の評価指標として最も一般的に用いられるものである。$R$をある道路区間における事故率（件/億台キロまたは人/億台キロ）事故率の計算式は以下で表される。ここで、$N$は一年間の事故件数（件または人）、$Q$は一日当りの交通量（台/日）、$L$は道路の区間延長（km）を表す。
\begin{equation}
  R = \frac{N}{Q \times L }
\end{equation}
国土交通省が交通事故統合データベースを用いて算出した、現実の事故における交通量と事故率の関係と比較した。図\ref{fig:MLIT}に示す。このデータベースでは、ある一定の区間内で発生した事故を全国で記録したものからなっている。また、グラフの事故率はデータ内の各交通区間における交通量が一定の値に含まれる交通区間での平均の事故率を表している。この結果によると、交通量が増加するとともに事故率は一度増加して、その後減少するという一様ではないが、連続的な動きをみている。事故率が交通量で基準化した値にも関わらずまだ交通量の変化に伴って変化することから、交通量の変化により交通現象が変化していることが考えられる。
\begin{figure}[tbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/MLIT.png}
  \caption{交通事故統合データベースにおける交通量と事故率の関係}
  \label{fig:MLIT}
\end{figure}
\clearpage
また、エラー率に対する感度解析では、エラー率と事故率の関係を線形近似することで、事故率をコントロールする際にエラー率をどの程度にすればよいかを知る関数を作成した。MATESでは小型車と大型車がエージェントとして存在しており、現実の値と近づけるため、大型車の発生割合は小型車の３割程度としている。



\subsection{追突更事故}
\subsubsection{挙動検証}
\clearpage
\subsubsection{感度解析}
\clearpage
\subsection{出会い頭事故}
\subsubsection{挙動検証}
\clearpage
\subsubsection{感度解析}
\clearpage


%右左折始まり
\subsection{右左折事故}
\subsubsection{右左折事故の挙動検証}
図\ref{fig:lr-behaviour}に右左折事故の状態を示す。この図では上側、下側から交差点に進入しようとするエージェントをそれぞれ、エージェントa,bとする。図ではa,bの両方に右左折のエラーが起きている。右左折エラーが起きていない場合は、この状態ではaは非優先車であり、優先車両であるbが進入しようとしているため、交差点前で停止するはずであるが、傲慢なエラーが起きているため、進入することで事故が発生している。
\newpage
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-behavior.png}
  \caption{右左折事故の挙動}
  \label{fig:behavior}
\end{figure}
\clearpage
\subsubsection{右左折事故の交通量と事故率の関係}
シミュレーションにおける道路図を図\ref{fig:lr-roadmap}に示す。また、車両は４つの車線全てから同じ割合で発生し、交差点には信号が設置されている。右左折事故における交通量と事故率の関係を図\ref{fig:lr-traffic-accident}に示す。交通量が1500台/月のあたりでピークに達し、その後ゆるやかに事故率が減少していくのがわかる。これは交通量が増え渋滞が生じると、連続的に優先道路のエージェントが交差点に侵入し、傲慢な判断エラーが生じていても、エラー車の方が先に交差点を通過できるという判断を行わないためである。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-roadmap.png}
  \caption{右左折事故における道路図}
  \label{fig:lr-roadmap}
\end{figure}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-traffic-accident.png}
  \caption{右左折事故における交通量と事故率の関係}
  \label{fig:lr-traffic-accident}
\end{figure}
\subsubsection{右左折事故のエラー率と事故率の関係}
エラー率と事故率の関係を図\ref{fig:lr-error-accident}に示す。この結果から、エラー率と事故率が線形関係にあることがわかった。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-error-accident.png}
  \caption{右左折事故におけるエラー率と事故率の関係}
  \label{fig:lr-error-accident}
\end{figure}

%右左折終了

%右左折始まり
\subsection{右左折事故}
\subsubsection{右左折事故の挙動検証}
図\ref{fig:lr-behaviour}に右左折事故の状態を示す。この図では上側、下側から交差点に進入しようとするエージェントをそれぞれ、エージェントa,bとする。図ではa,bの両方に右左折のエラーが起きている。右左折エラーが起きていない場合は、この状態ではaは非優先車であり、優先車両であるbが進入しようとしているため、交差点前で停止するはずであるが、傲慢なエラーが起きているため、進入することで事故が発生している。
\newpage
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-behavior.png}
  \caption{右左折事故の挙動}
  \label{fig:behavior}
\end{figure}
\clearpage
\subsubsection{右左折事故の交通量と事故率の関係}
シミュレーションにおける道路図を図\ref{fig:lr-roadmap}に示す。また、車両は４つの車線全てから同じ割合で発生し、交差点には信号が設置されている。右左折事故における交通量と事故率の関係を図\ref{fig:lr-traffic-accident}に示す。交通量が1500台/月のあたりでピークに達し、その後ゆるやかに事故率が減少していくのがわかる。これは交通量が増え渋滞が生じると、連続的に優先道路のエージェントが交差点に侵入し、傲慢な判断エラーが生じていても、エラー車の方が先に交差点を通過できるという判断を行わないためである。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-roadmap.png}
  \caption{右左折事故における道路図}
  \label{fig:lr-roadmap}
\end{figure}
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-traffic-accident.png}
  \caption{右左折事故における交通量と事故率の関係}
  \label{fig:lr-traffic-accident}
\end{figure}
\subsubsection{右左折事故のエラー率と事故率の関係}
エラー率と事故率の関係を図\ref{fig:lr-error-accident}に示す。この結果から、エラー率と事故率が線形関係にあることがわかった。
\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.8\hsize,bb=0 0 826 882]{./img/lr-error-accident.png}
  \caption{右左折事故におけるエラー率と事故率の関係}
  \label{fig:lr-error-accident}
\end{figure}
%右左折終了


\subsubsection{感度解析}
\clearpage
\subsection{進路変更事故}
\subsubsection{挙動検証}
\clearpage
\subsubsection{感度解析}
\clearpage
\subsection{正面衝突事故}
\subsubsection{挙動検証}
\clearpage
\subsubsection{感度解析}

\clearpage
\section{実都市への応用}
感度解析から得られた結果と、事故が起こる割合から実際の都市（岡山市）の道路情報を用いたシミュレーションを行った。事故が起こる割合には
シミュレーションの条件
\section{結論}

\section{表と図}
表と図は結構むずかしい。
基本的には HTML と同じような思考で取り組むと大体正しい。
\subsection{表}
表\ref{tab:sample}に表の例を示す。
%
\begin{table}[htbp] % 表の位置 (h, t, b, p を優先順に並べる)。h: ここ; t: ページ上部; b: ページ下部; p: 新しいページ
 \centering % 表のセンタリング
 \caption{表のサンプル}\label{tab:sample} % キャプションとラベル
 \begin{tabular}{r|cl} % 列と縦線。c: 中央揃え; l: 左揃え; r: 右揃え; |: 縦線
  \hline % 横線
  右 & 中央 & 左 \\
  \hline\hline % 横線を 2 本
  みぎ  & ちゅうおう & ひだり \\
  Right & Center     & Left \\
  \hline
 \end{tabular}
\end{table}
%
\begin{thebibliography}{9}
 \bibitem{ITS-Japan}
        特定非営利活動法人ITS Japan.
        ITSとは.
         \url{http://www.its-jp.org/about/} % url.sty のコマンドを使っている。
 \bibitem{MLIT-1}
 	国土交通省,
	ITSスポット
 	\url{http://www.mlit.go.jp/road/ITS/j-html/spot_dsrc/}
 \bibitem{MLIT-2}
 	国土交通省,
	自動車総合安全情報　衝突被害軽減ブレーキ
	\url{http://www.mlit.go.jp/jidosha/anzen/01asv/esc.html}
 \bibitem{police2013}
 	警察庁交通局，
	平成24年中の事故発生状況,
	 2013
\bibitem{ITARDA2005}	 
	 交通事故分析センター，
	 ITARDA Information，
	 No.56，2005
\bibitem{Furukawa2009}
	 古川修，
	 安全運転支援システムの効果評価のためのUDMを用いた交通流シミュレータの開発，
	 自動車技術，
	 Vol.63，No.2 ，pp.104-107，2009
\bibitem{Fujii2011}	 
	 藤井秀樹，吉村忍，高野悠哉，
	 マルチエージェント交通流シミュレーションにおける交通事故モデリング，
	 人工知能学会論文誌，
	  Vol.26，No.1 ，pp.42-49，2011
 \bibitem{manual2013}
	自動車技術会，
	交通事故予測シミュレーションシステム検証マニュアル，
	2013
 \bibitem{yamada2010}
	山田真大，青木優，日高隆博，山崎二三雄，佐藤健哉，高田広章，
	交通事故シナリオに基づく予防安全システムのシミュレーション分析，
	情報処理学会研究報告．ITS，[高度交通システム]
	Vol41，No.2，pp.1-8，2010
 \bibitem{ITARDA2003}
	交通事故総合分析センター，
	追突事故はどうして起きるのか”，
	ITARDA INFORMATION，No.43，2003
 \bibitem{ITARDA2005}
	交通事故総合分析センター，
	出会い頭事故における人的要因の分析，
	ITARDA INFORMATION，No.56，2005
 \bibitem{jsae-movie}
	自動車技術会，
 	ドライブレコーダは見た！　自動車技術会「ヒヤリハットデータベース」より，
	\url{http://www.jsae.or.jp/hiyari/1009/}
 \bibitem{katsuoka}
	勝岡秀明，
	四輪車の正面衝突事故発生状況と特徴の分析，
	交通事故総合分析センター研究発表会論文集，
	2010
 \bibitem{MLIT3}
	国土交通省国土技術政策総合研究所，
	交通事故統合データベースを用いたマクロ交通事故分析
	，国総研資料， No.48，2002
\end{thebibliography}
%
% 本文を終わりにする。
%

\end{document}
